document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let i=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),i.unobserve(t)}})});e.forEach(function(e){i.observe(e)});let a=new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&(e.target.classList.add("visible"),a.unobserve(e.target))})});t.forEach(function(e){a.observe(e)});let o=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}})});n.forEach(function(e){o.observe(e)})}else e.forEach(function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset}),t.forEach(function(e){e.classList.add("visible")}),n.forEach(function(e){e.style.backgroundImage="url("+e.dataset.bg+")"})});let searchForm=document.querySelector("#search-form"),movie=document.querySelector("#movies"),urlPoster="https://image.tmdb.org/t/p/w500",explorer=document.querySelector(".explorer");searchForm.addEventListener("submit",apiSearch);let icon=document.querySelector(".search__icon"),search=document.querySelector(".search__input");icon.addEventListener("click",()=>{icon.classList.add("search__icon_active"),search.classList.add("search__input_active")}),search.addEventListener("blur",()=>{icon.classList.remove("search__icon_active"),search.classList.remove("search__input_active")});let popular=document.querySelector(".nav__item_popular"),upcoming=document.querySelector(".nav__item_upcoming"),topMovies=document.querySelector(".nav__item_movie-top"),topTv=document.querySelector(".nav__item_tv-top");function apiSearch(e){e.preventDefault();let t=document.querySelector("#searchText").value;0===t.trim().length&&(movie.innerHTML='<h2 class="col-12 text-center text-danger">Поле поиска не должно быть пустым</h2>'),movie.innerHTML='<div class="spinner"></div>',fetch("https://api.themoviedb.org/3/search/multi?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru&query=%27"+t).then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){let n=`<h4 class="col-12 grid-title">Результаты по запросу "${t}"</h4>`;0===e.results.length&&(n='<h2 class="col-12 text-center grid-title">По вашему запросу ничего не найдено</h2>'),e.results.forEach(function(e){let t=e.name||e.title,i=e.poster_path?urlPoster+e.poster_path:"./img/noposter.png",a=e.first_air_date||e.release_date,o="";"person"!==e.media_type&&(o=`data-id="${e.id}" data-type="${e.media_type}"`),n+=`<div class="col-12 col-md-4 col-xl-2 item  data-genre="${e.genre_ids}">\n\t\t\t\t<img src="${i}" class="item__poster img-responsive" alt="${t}" ${o}>\n        <h5 class="item__title">${t}</h5>\n        <h4 class="item__date">${a}</h4>\n        </div>`}),movie.innerHTML=n,addEventMedia()}).catch(function(e){movie.innerHTML="Упс, что-то пошло не так!",console.log("error:"+e)})}function addEventMedia(){movie.querySelectorAll("img[data-id]").forEach(function(e){e.style.cursor="pointer",e.addEventListener("click",showFullInfo)})}function showFullInfo(){let e="";"movie"===this.dataset.type?e=`https://api.themoviedb.org/3/movie/${this.dataset.id}?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru`:"tv"===this.dataset.type?e=`https://api.themoviedb.org/3/tv/${this.dataset.id}?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru`:movie.innerHTML="Упс, что-то пошло не так!",typeMedia=this.dataset.type,idMedia=this.dataset.id,fetch(e).then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){explorer.classList.add("container"),explorer.innerHTML=`<h4 class="col-12 text-center text-info head-title head-title_accent ">${e.name||e.title}</h4>\n      <div class="row about">\n          <div class="col-6 about__keyart">\n          <img class="img-responsive about__poster" src='${urlPoster+e.poster_path}' alt="${e.name||e.title}">\n          </div>\n          <div class="col-6 about__info">\n          <h3 class="about__title">${e.name||e.title}</h3>\n          <p class="about__date">${e.first_air_date||e.release_date} ${"| "+e.genres[0].name||""}</p>\n          <p class="about__rate">Рейтинг: ${e.vote_average}</p>\n          ${e.last_episode_to_air?`<p>Сезонов: ${e.number_of_seasons}<br>Ceрий: ${e.last_episode_to_air.episode_number}</p>`:""}\n          <p>${e.overview}</p>\n          <div class="youtube"></div>\n          <div class="about__links">\n          ${e.homepage?`<a class="about__link" href="${e.homepage}" target="_blank">Официальная страница</a>`:""} \n          ${e.imdb_id?`<a class="about__link" href="https://imdb.com/title/${e.imdb_id}" target="_blank">Страница на IMDB.com</a>`:""}\n          </div>\n          </div>\n        </div>`,getVideo(typeMedia,idMedia)}).catch(function(){movie.innerHTML="Упс, что-то пошло не так!",console.log("error")})}function getPopular(){fetch("https://api.themoviedb.org/3/trending/all/week?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru").then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){let t='<h4 class="col-12 grid-title">Популярные за неделю</h4>';0===e.results.length&&(t='<h2 class="col-12 text-center text-info">По вашему запросу ничего не найдено</h2>'),e.results.forEach(function(e){let n=e.name||e.title,i=e.title?"movie":"tv",a=e.poster_path?urlPoster+e.poster_path:"./img/noposter.png",o=e.first_air_date||e.release_date;newDate=o.split("-").join(" | ");let s=`data-id="${e.id}" data-type="${i}"`;t+=`<div class="col-12 col-md-4 col-xl-2 item"  data-genre="${e.genre_ids}">\n\t\t\t\t<img src="${a}" class="item__poster img-responsive" alt="${n}" ${s}>\n        <h5 class="item__title">${n}</h5>\n        <h5 class="item__date">${newDate}</h5>\n\t\t\t\t</div>`}),movie.innerHTML=t,addEventMedia()}).catch(function(e){movie.innerHTML="Упс, что-то пошло не так!",console.log("error:"+e)})}function getUpcoming(){fetch("https://api.themoviedb.org/3/movie/upcoming?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru&page=1").then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){console.log(e);let t='<h4 class="col-12 grid-title">Новинки</h4>';0===e.results.length&&(t='<h2 class="col-12 text-center text-info">По вашему запросу ничего не найдено</h2>'),e.results.forEach(function(e){let n=e.name||e.title,i=e.title?"movie":"tv",a=e.poster_path?urlPoster+e.poster_path:"./img/noposter.png",o=e.first_air_date||e.release_date;newDate=o.split("-").join(" | ");let s=`data-id="${e.id}" data-type="${i}"`;t+=`<div class="col-12 col-md-4 col-xl-2 item"  data-genre="${e.genre_ids}">\n\t\t\t\t<img src="${a}" class="item__poster img-responsive" alt="${n}" ${s}>\n        <h5 class="item__title">${n}</h5>\n        <h5 class="item__date">${newDate}</h5>\n\t\t\t\t</div>`}),movie.innerHTML=t,addEventMedia()}).catch(function(e){movie.innerHTML="Упс, что-то пошло не так!",console.log("error:"+e)})}function getTopMovies(){fetch("https://api.themoviedb.org/3/movie/top_rated?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru&page=1").then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){console.log(e);let t='<h4 class="col-12 grid-title">Лучшие фильмы</h4>';0===e.results.length&&(t='<h2 class="col-12 text-center text-info">По вашему запросу ничего не найдено</h2>'),e.results.forEach(function(e){let n=e.name||e.title,i=e.title?"movie":"tv",a=e.poster_path?urlPoster+e.poster_path:"./img/noposter.png",o=e.first_air_date||e.release_date;newDate=o.split("-").join(" | ");let s=`data-id="${e.id}" data-type="${i}"`;t+=`<div class="col-12 col-md-4 col-xl-2 item"  data-genre="${e.genre_ids}">\n\t\t\t\t<img src="${a}" class="item__poster img-responsive" alt="${n}" ${s}>\n        <h5 class="item__title">${n}</h5>\n        <h5 class="item__date">${newDate}</h5>\n\t\t\t\t</div>`}),movie.innerHTML=t,addEventMedia()}).catch(function(e){movie.innerHTML="Упс, что-то пошло не так!",console.log("error:"+e)})}function getTopTv(){fetch("https://api.themoviedb.org/3/tv/top_rated?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru&page=1").then(function(e){return 200!==e.status?Promise.reject():e.json()}).then(function(e){console.log(e);let t='<h4 class="col-12 grid-title">Лучшие сериалы</h4>';0===e.results.length&&(t='<h2 class="col-12 text-center text-info">По вашему запросу ничего не найдено</h2>'),e.results.forEach(function(e){let n=e.name||e.title,i=e.title?"movie":"tv",a=e.poster_path?urlPoster+e.poster_path:"./img/noposter.png",o=e.first_air_date||e.release_date;newDate=o.split("-").join(" | ");let s=`data-id="${e.id}" data-type="${i}"`;t+=`<div class="col-12 col-md-4 col-xl-2 item"  data-genre="${e.genre_ids}">\n\t\t\t\t<img src="${a}" class="item__poster img-responsive" alt="${n}" ${s}>\n        <h5 class="item__title">${n}</h5>\n        <h5 class="item__date">${newDate}</h5>\n\t\t\t\t</div>`}),movie.innerHTML=t,addEventMedia()}).catch(function(e){movie.innerHTML="Упс, что-то пошло не так!",console.log("error:"+e)})}function getVideo(e,t){let n=document.querySelector(".youtube");fetch(`https://api.themoviedb.org/3/${e}/${t}/videos?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru`).then(e=>200!==e.status?Promise.reject():e.json()).then(e=>{let t='<h5 class="col-12">Трейлер</h5>';t+=`<iframe width="560" height="315" src="https://www.youtube.com/embed/${e.results[0].key}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`,n.innerHTML=t}).catch(function(e){n.innerHTML=" ",console.log("error:"+e)})}function getGenres(){let e=document.querySelector(".sidebar__genres");fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=d1777f7d2dcd8568a3d1a207d0b05303&language=ru").then(e=>200!==e.status?Promise.reject():e.json()).then(t=>{t.genres.forEach(t=>{e.innerHTML+=`<li class="sidebar__genre"><input type="checkbox" class="sidebar__check" data-id="${t.id}"><span class="sidebar__faux"></span><span class="sidebar__text">${t.name}</span></li>`,sortByGenres()}).catch(function(e){youtube.innerHTML=" ",console.log("error:"+e)})})}function sortByGenres(){let e=document.querySelectorAll("input.sidebar__check"),t=document.querySelectorAll(".item");e.forEach(e=>{e.addEventListener("click",()=>{let n=e.getAttribute("data-id");t.forEach(t=>{let i=t.getAttribute("data-genre").split(",");e.checked?-1!=i.indexOf(n)?t.style.display="":t.style.display="none":t.style.display="block"})})})}console.log(upcoming),popular.addEventListener("click",getPopular),upcoming.addEventListener("click",getUpcoming),topMovies.addEventListener("click",getTopMovies),topTv.addEventListener("click",getTopTv),document.addEventListener("DOMContentLoaded",()=>{getPopular(),getGenres()});